const CACHE_NAME="story-app-shell-v1",RUNTIME_CACHE="story-app-runtime-v1",IMAGE_CACHE="story-app-images-v1",API_CACHE="story-app-api-v1",PRECACHE_URLS=["/","/index.html","/offline.html","/favicon.png","/styles.bundle.css"];async function networkFirst(t,e=RUNTIME_CACHE){try{const n=await fetch(t);if(n&&n.ok){const o=n.clone();return caches.open(e).then((e=>e.put(t,o))),n}return await caches.match(t)||n}catch(e){const n=await caches.match(t);if(n)return n;throw e}}async function cacheFirst(t,e=IMAGE_CACHE){const n=await caches.match(t);if(n)return n;try{const n=await fetch(t);if(n&&n.ok){const o=n.clone();caches.open(e).then((e=>e.put(t,o)))}return n}catch(t){return null}}self.addEventListener("install",(t=>{t.waitUntil(caches.open(CACHE_NAME).then((t=>t.addAll(PRECACHE_URLS).catch((t=>{console.warn("Precaching failed for some assets:",t)})))).then((()=>self.skipWaiting())))})),self.addEventListener("activate",(t=>{t.waitUntil(caches.keys().then((t=>Promise.all(t.map((t=>[CACHE_NAME,RUNTIME_CACHE,IMAGE_CACHE,API_CACHE].includes(t)?null:caches.delete(t)))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(t=>{const{request:e}=t,n=new URL(e.url);"GET"===e.method&&("navigate"===e.mode||(e.headers.get("accept")||"").includes("text/html")?t.respondWith(networkFirst(e).then((t=>!t||t.status&&t.status>=400?caches.match("/offline.html"):t)).catch((()=>caches.match("/offline.html")))):"image"===e.destination||/\.(png|jpg|jpeg|gif|webp|svg)$/.test(n.pathname)?t.respondWith(cacheFirst(e).then((t=>t||fetch(e).catch((()=>caches.match("/favicon.png")))))):n.origin.includes("story-api.dicoding.dev")?t.respondWith((async()=>{try{const t=await fetch(e);if(t&&t.ok){const n=t.clone();return(await caches.open(API_CACHE)).put(e,n),t}return await caches.match(e)||t}catch(t){return await caches.match(e)||new Response(JSON.stringify({error:!0,message:"Network error"}),{status:503,headers:{"Content-Type":"application/json"}})}})()):t.respondWith(caches.match(e).then((t=>t||fetch(e).then((t=>{if(t&&t.ok&&("script"===e.destination||"style"===e.destination)){const n=t.clone();caches.open(RUNTIME_CACHE).then((t=>t.put(e,n)))}return t})).catch((()=>null))))))})),self.addEventListener("push",(t=>{let e={title:"Story App",options:{body:"You have a new message",icon:"/favicon.png"}};try{if(t.data){const n=t.data.json?t.data.json():JSON.parse(t.data.text());e={title:n.title||e.title,options:{body:n.options&&n.options.body||n.body||e.options.body,icon:n.options&&n.options.icon||"/favicon.png",badge:n.options&&n.options.badge||void 0,data:n.options&&n.options.data?n.options.data:void 0}}}}catch(n){console.warn("push event parse failed",n);try{e={title:"Story App",options:{body:t.data?.text()||e.options.body}}}catch(t){}}t.waitUntil(self.registration.showNotification(e.title,e.options))})),self.addEventListener("notificationclick",(t=>{t.notification.close();const e=t.notification.data?.url||"/";t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((t=>{for(const n of t)if(n.url===e&&"focus"in n)return n.focus();return clients.openWindow?clients.openWindow(e):null})).catch((t=>console.error("notificationclick error",t))))}));